<div class="settings-page">
  <header class="page-header">
    <div class="header-info">
      <h1 class="page-title"><i class="fas fa-building"></i> Business Settings</h1>
      <p class="page-description">Configure your organization's identity, localization, and system preferences</p>
    </div>
    <div class="header-status" *ngIf="isSaving">
      <span class="pulse-icon"></span>
      Saving changes...
    </div>
  </header>

  <!-- Success/Error Messages -->
  <div class="alert alert-success" *ngIf="successMessage">
    <i class="fas fa-check-circle"></i>
    <span>{{ successMessage }}</span>
  </div>
  
  <div class="alert alert-error" *ngIf="errorMessage">
    <i class="fas fa-exclamation-circle"></i>
    <span>{{ errorMessage }}</span>
  </div>

  <div class="settings-sections" *ngIf="!isLoading">
    <!-- Company Information -->
    <section class="settings-card">
      <div class="card-header">
        <div class="header-icon"><i class="fas fa-info-circle"></i></div>
        <div class="header-text">
          <h2 class="card-title">Company Information</h2>
          <p class="card-description">Official details and contact information</p>
        </div>
      </div>

      <form [formGroup]="companyForm" (ngSubmit)="onSaveCompany()" class="form" *ngIf="companyForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="companyName" class="form-label">Company Name *</label>
            <input id="companyName" formControlName="companyName" type="text" class="form-input" placeholder="Enter your company name" />
            <div class="form-error" *ngIf="companyForm.get('companyName')?.invalid && companyForm.get('companyName')?.touched">
              Company name is required
            </div>
          </div>

          <div class="form-group">
            <label for="industry" class="form-label">Industry</label>
            <select id="industry" formControlName="industry" class="form-select">
              <option *ngFor="let ind of industries" [value]="ind">{{ ind | titlecase }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="taxId" class="form-label">Tax ID / VAT Number</label>
            <input id="taxId" formControlName="taxId" type="text" class="form-input" placeholder="Enter Tax ID" />
          </div>

          <div class="form-group">
            <label for="phone" class="form-label">Phone Number</label>
            <input id="phone" formControlName="phone" type="tel" class="form-input" placeholder="+1 (555) 123-4567" />
          </div>

          <div class="form-group">
            <label for="email" class="form-label">Business Email</label>
            <input id="email" formControlName="email" type="email" class="form-input" placeholder="contact@company.com" />
          </div>

          <div class="form-group">
            <label for="website" class="form-label">Website URL</label>
            <input id="website" formControlName="website" type="url" class="form-input" placeholder="https://www.company.com" />
          </div>

          <div class="form-group full-width">
            <label for="address" class="form-label">Business Address</label>
            <textarea id="address" formControlName="address" class="form-textarea" rows="2" placeholder="Enter your business address"></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="companyForm.invalid || isSaving">
            <i class="fas fa-save" *ngIf="!isSaving"></i>
            <span>{{ isSaving ? 'Saving...' : 'Update Company Info' }}</span>
          </button>
        </div>
      </form>
    </section>

    <!-- Regional Settings -->
    <section class="settings-card">
      <div class="card-header">
        <div class="header-icon"><i class="fas fa-globe"></i></div>
        <div class="header-text">
          <h2 class="card-title">Regional Settings</h2>
          <p class="card-description">Localization, currency, and timezone preferences</p>
        </div>
      </div>

      <form [formGroup]="regionalForm" (ngSubmit)="onSaveRegional()" class="form" *ngIf="regionalForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="currency" class="form-label">Main Currency *</label>
            <select id="currency" formControlName="currency" class="form-select">
              <option *ngFor="let curr of currencies" [value]="curr">{{ curr }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="timezone" class="form-label">Select Timezone *</label>
            <select id="timezone" formControlName="timezone" class="form-select">
              <option value="UTC">UTC (Universal)</option>
              <option value="Asia/Karachi">PKT (Pakistan)</option>
              <option value="Asia/Dubai">GST (Dubai)</option>
              <option value="Europe/London">GMT (London)</option>
              <option value="America/New_York">EST (New York)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="dateFormat" class="form-label">Preferred Date Format</label>
            <select id="dateFormat" formControlName="dateFormat" class="form-select">
              <option *ngFor="let fmt of dateFormats" [value]="fmt">{{ fmt }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="language" class="form-label">System Language</label>
            <select id="language" formControlName="language" class="form-select">
              <option *ngFor="let lang of languages" [value]="lang.code">{{ lang.name }}</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="regionalForm.invalid || isSaving">
            <i class="fas fa-save" *ngIf="!isSaving"></i>
            <span>{{ isSaving ? 'Saving...' : 'Update Regional Settings' }}</span>
          </button>
        </div>
      </form>
    </section>

    <!-- Business Preferences -->
    <section class="settings-card">
      <div class="card-header">
        <div class="header-icon"><i class="fas fa-cog"></i></div>
        <div class="header-text">
          <h2 class="card-title">Operational Preferences</h2>
          <p class="card-description">Fiscal rules and inventory behavior</p>
        </div>
      </div>

      <form [formGroup]="preferencesForm" (ngSubmit)="onSavePreferences()" class="form" *ngIf="preferencesForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="fiscalYearStart" class="form-label">Fiscal Year Start Month</label>
            <select id="fiscalYearStart" formControlName="fiscalYearStart" class="form-select">
              <option value="01">January</option>
              <option value="04">April</option>
              <option value="07">July</option>
              <option value="10">October</option>
            </select>
          </div>

          <div class="form-group">
            <label for="fiscalYearEnd" class="form-label">Fiscal Year End Month</label>
            <select id="fiscalYearEnd" formControlName="fiscalYearEnd" class="form-select">
              <option value="12">December</option>
              <option value="03">March</option>
              <option value="06">June</option>
              <option value="09">September</option>
            </select>
          </div>

          <div class="form-group">
            <label for="defaultTaxRate" class="form-label">Default Tax Rate (%)</label>
            <input id="defaultTaxRate" formControlName="defaultTaxRate" type="number" class="form-input" step="0.01" />
          </div>

          <div class="form-group">
            <label for="autoSkuPrefix" class="form-label">Auto SKU Prefix</label>
            <input id="autoSkuPrefix" formControlName="autoSkuPrefix" type="text" class="form-input" />
          </div>
        </div>

        <div class="feature-toggles">
          <h3 class="section-title">Module Feature Toggles</h3>
          <div class="toggle-grid">
            <label class="toggle-item">
              <input type="checkbox" formControlName="enableMultiLocation" class="form-checkbox">
              <div class="toggle-content">
                <span class="toggle-label">Multi-location</span>
                <span class="toggle-help">Manage stock across multiple warehouses</span>
              </div>
            </label>
            <label class="toggle-item">
              <input type="checkbox" formControlName="enableTaxCalculation" class="form-checkbox">
              <div class="toggle-content">
                <span class="toggle-label">Auto Tax</span>
                <span class="toggle-help">Calculate taxes on checkout automatically</span>
              </div>
            </label>
            <label class="toggle-item">
              <input type="checkbox" formControlName="enableDiscounts" class="form-checkbox">
              <div class="toggle-content">
                <span class="toggle-label">Discounts</span>
                <span class="toggle-help">Apply percentage or fixed discounts</span>
              </div>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="preferencesForm.invalid || isSaving">
            <i class="fas fa-save" *ngIf="!isSaving"></i>
            <span>{{ isSaving ? 'Saving...' : 'Update Preferences' }}</span>
          </button>
        </div>
      </form>
    </section>

    <!-- System & Brand Settings -->
    <section class="settings-card">
      <div class="card-header">
        <div class="header-icon"><i class="fas fa-vial"></i></div>
        <div class="header-text">
          <h2 class="card-title">System & Branding</h2>
          <p class="card-description">Control system-wide behavior and appearance</p>
        </div>
      </div>

      <form [formGroup]="systemForm" (ngSubmit)="onSaveSystem()" class="form" *ngIf="systemForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="defaultTheme" class="form-label">Global Theme</label>
            <select id="defaultTheme" formControlName="defaultTheme" class="form-select">
              <option value="light">Light Mode</option>
              <option value="dark">Dark Mode</option>
              <option value="system">Follow System</option>
            </select>
          </div>

          <div class="form-group">
            <label for="systemLogo" class="form-label">System Logo URL</label>
            <input id="systemLogo" formControlName="systemLogo" type="text" class="form-input" placeholder="URL to your logo" />
          </div>

          <div class="form-group full-width">
            <label for="emailSignature" class="form-label">Default Email Signature</label>
            <textarea id="emailSignature" formControlName="emailSignature" class="form-textarea" rows="2" placeholder="Regards, Team..."></textarea>
          </div>
        </div>

        <div class="danger-zone">
          <h3 class="section-title">Maintenance Mode</h3>
          <div class="toggle-item danger">
            <input type="checkbox" formControlName="maintenanceMode" class="form-checkbox">
            <div class="toggle-content">
              <span class="toggle-label">Enable Maintenance Mode</span>
              <span class="toggle-help">Only admins will be able to access the system</span>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="systemForm.invalid || isSaving">
            <i class="fas fa-save" *ngIf="!isSaving"></i>
            <span>{{ isSaving ? 'Saving...' : 'Update System' }}</span>
          </button>
        </div>
      </form>
    </section>
  </div>

  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Retrieving organization settings...</p>
  </div>
</div>
