<div class="dashboard-container">
  <div class="floating-particles">
    <div class="particle" *ngFor="let i of [1,2,3,4,5,6,7,8]"></div>
  </div>
  
  <header class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class="fas fa-chart-line"></i>
        Inventory Dashboard
      </h1>
      <p class="dashboard-subtitle">Real-time overview of your inventory management system</p>
      <div class="last-updated">
        <i class="fas fa-sync-alt"></i>
        Auto-refreshing every 30 seconds
      </div>
      <div class="header-stats">
        <div class="quick-stat">
          <span class="stat-number">{{ stats.totalproducts | number }}</span>
          <span class="stat-label">Products</span>
        </div>
        <div class="quick-stat">
          <span class="stat-number">{{ stats.totalsuppliers | number }}</span>
          <span class="stat-label">Suppliers</span>
        </div>
        <div class="quick-stat">
          <span class="stat-number">{{ stats.totalStock | number }}</span>
          <span class="stat-label">Stock Units</span>
        </div>
      </div>
    </div>
  </header>
  
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading dashboard data...</p>
  </div>
  
  <div *ngIf="error" class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadDashboard()">
      <i class="fas fa-redo"></i>
      Retry
    </button>
  </div>
  
  <div *ngIf="!loading && !error" class="dashboard-content">
    <!-- KPI Section -->
    <section class="kpi-section">
      <h2 class="section-title">Key Performance Indicators</h2>
      <div class="kpi-grid">
        <div class="kpi-card kpi-primary" [style.animation-delay]="'0.1s'">
          <div class="kpi-icon">
            <i class="fas fa-box"></i>
          </div>
          <div class="kpi-content">
            <h3>Total Products</h3>
            <p class="kpi-value" [attr.data-count]="stats.totalproducts">{{ stats.totalproducts | number }}</p>
            <span class="kpi-label">Active inventory items</span>
            <div class="kpi-trend">
              <i class="fas fa-arrow-up trend-up"></i>
              <span class="trend-text">+5.2% from last month</span>
            </div>
          </div>
        </div>
        
        <div class="kpi-card kpi-success" [style.animation-delay]="'0.2s'">
          <div class="kpi-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="kpi-content">
            <h3>Total Suppliers</h3>
            <p class="kpi-value" [attr.data-count]="stats.totalsuppliers">{{ stats.totalsuppliers | number }}</p>
            <span class="kpi-label">Active suppliers</span>
            <div class="kpi-trend">
              <i class="fas fa-arrow-up trend-up"></i>
              <span class="trend-text">+2.1% from last month</span>
            </div>
          </div>
        </div>
        
        <div class="kpi-card kpi-info" [style.animation-delay]="'0.3s'">
          <div class="kpi-icon">
            <i class="fas fa-warehouse"></i>
          </div>
          <div class="kpi-content">
            <h3>Total Stock</h3>
            <p class="kpi-value" [attr.data-count]="stats.totalStock">{{ stats.totalStock | number }}</p>
            <span class="kpi-label">Units in inventory</span>
            <div class="kpi-trend">
              <i class="fas fa-arrow-down trend-down"></i>
              <span class="trend-text">-1.3% from last month</span>
            </div>
          </div>
        </div>
        
        <div class="kpi-card kpi-warning" [style.animation-delay]="'0.4s'">
          <div class="kpi-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="kpi-content">
            <h3>Purchase Value</h3>
            <p class="kpi-value" [attr.data-count]="stats.totalpurchases">{{ stats.totalpurchases | currency:'USD':'symbol':'1.0-0' }}</p>
            <span class="kpi-label">Total purchase amount</span>
            <div class="kpi-trend">
              <i class="fas fa-arrow-up trend-up"></i>
              <span class="trend-text">+12.8% from last month</span>
            </div>
          </div>
        </div>
        
        <div class="kpi-card kpi-danger" [class.kpi-alert]="stats.lowStockItems > 0" [style.animation-delay]="'0.5s'">
          <div class="kpi-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="kpi-content">
            <h3>Low Stock Alerts</h3>
            <p class="kpi-value" [attr.data-count]="stats.lowStockItems">{{ stats.lowStockItems | number }}</p>
            <span class="kpi-label">Items need attention</span>
            <div class="kpi-trend" *ngIf="stats.lowStockItems > 0">
              <i class="fas fa-exclamation-circle trend-alert"></i>
              <span class="trend-text alert-text">Immediate action required</span>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Today's Activity Section -->
    <section class="activity-section">
      <h2 class="section-title">Today's Activity</h2>
      <div class="activity-grid">
        <div class="activity-card activity-positive">
          <div class="activity-icon">
            <i class="fas fa-arrow-up"></i>
          </div>
          <div class="activity-content">
            <h3>Stock In</h3>
            <p class="activity-value">+{{ stats.stockInToday | number }}</p>
            <span class="activity-label">Units received today</span>
          </div>
        </div>
        
        <div class="activity-card activity-negative">
          <div class="activity-icon">
            <i class="fas fa-arrow-down"></i>
          </div>
          <div class="activity-content">
            <h3>Stock Out</h3>
            <p class="activity-value">-{{ stats.stockOutToday | number }}</p>
            <span class="activity-label">Units dispatched today</span>
          </div>
        </div>
        
        <div class="activity-card activity-neutral">
          <div class="activity-icon">
            <i class="fas fa-exchange-alt"></i>
          </div>
          <div class="activity-content">
            <h3>Net Movement</h3>
            <p class="activity-value" 
               [class.positive]="(stats.stockInToday - stats.stockOutToday) > 0"
               [class.negative]="(stats.stockInToday - stats.stockOutToday) < 0">
              {{ (stats.stockInToday - stats.stockOutToday) | number:'+1.0-0' }}
            </p>
            <span class="activity-label">Today's net change</span>
          </div>
        </div>
        
        <div class="activity-card activity-warning">
          <div class="activity-icon">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="activity-content">
            <h3>Pending Orders</h3>
            <p class="activity-value">{{ stats.pendingPurchases | number }}</p>
            <span class="activity-label">Awaiting receipt</span>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Stock Trend Section -->
    <section class="charts-section">
      <h2 class="section-title">Stock Movement Analysis</h2>
      <div class="single-chart">
        <app-stock-trend [trend]="stockTrendData"></app-stock-trend>
      </div>
    </section>
    
    <!-- Purchase Trend Section -->
    <section class="charts-section">
      <h2 class="section-title">Purchase Analytics</h2>
      <div class="single-chart">
        <app-purchase-trend [trend]="purchaseTrendData"></app-purchase-trend>
      </div>
    </section>
    
    <!-- Sales Trend Section -->
    <section class="charts-section">
      <h2 class="section-title">Sales Performance</h2>
      <div class="single-chart">
        <app-sales-trend [trend]="salesTrendData"></app-sales-trend>
      </div>
    </section>
    
    <!-- Low Stock Widget Section -->
    <section class="widget-section">
      <app-low-stock-widget 
        [lowStockItems]="lowStockItems" 
        [totalCount]="stats.lowStockItems"
        (itemClick)="navigateToProduct($event)">
      </app-low-stock-widget>
    </section>
    
    <!-- Low Stock Alerts Section -->
    <section class="alerts-section" *ngIf="lowStockItems.length > 0">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-exclamation-triangle"></i>
          Low Stock Alerts
        </h2>
        <span class="alert-count">{{ lowStockItems.length }} items need attention</span>
      </div>
      
      <div class="alerts-grid">
        <div class="alert-card" 
             *ngFor="let item of lowStockItems.slice(0, 6); trackBy: trackByProductId"
             (click)="navigateToProduct(item)"
             role="button"
             tabindex="0">
          <div class="alert-header">
            <h4 class="alert-product">{{ item.productName }}</h4>
            <span class="alert-sku">{{ item.sku }}</span>
          </div>
          <div class="alert-location">
            <i class="fas fa-map-marker-alt"></i>
            {{ item.warehouseName }}
          </div>
          <div class="alert-metrics">
            <div class="metric">
              <span class="metric-label">Current</span>
              <span class="metric-value critical">{{ item.availableQty | number }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Min Required</span>
              <span class="metric-value">{{ item.minStock | number }}</span>
            </div>
          </div>
          <div class="alert-action">
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>
      
      <div class="alerts-footer" *ngIf="lowStockItems.length > 6">
        <p>{{ lowStockItems.length - 6 }} more items need attention</p>
        <button class="view-all-btn" (click)="router.navigate(['/stock/levels'])">
          View All Alerts
          <i class="fas fa-external-link-alt"></i>
        </button>
      </div>
    </section>
  </div>
</div>
