<div class="stock-movements animate-fade-in">
    <header class="page-header">
        <div class="header-content">
            <div class="title-section">
                <h1>Stock Movements</h1>
                <p class="subtitle">Log of all inventory adjustments, receipts, and shipments.</p>
            </div>
            <div class="header-actions">
                <button class="btn-primary" [routerLink]="['/stock/movements/new']">
                    <i class="fas fa-plus"></i> New Movement
                </button>
            </div>
        </div>
    </header>

    <main class="content-section">
        <div class="toolbar">
            <div class="search-field">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                       class="search-control" 
                       placeholder="Search products, warehouses or reasons..."
                       (input)="onSearch($event)">
            </div>
            
            <div class="filter-controls">
                <div class="filter-chips">
                    <button class="chip" [class.active]="typeFilter === 'ALL'" (click)="onFilterChange('ALL')">All</button>
                    <button class="chip" [class.active]="typeFilter === 'IN'" (click)="onFilterChange('IN')">Stock In</button>
                    <button class="chip" [class.active]="typeFilter === 'OUT'" (click)="onFilterChange('OUT')">Stock Out</button>
                    <button class="chip" [class.active]="typeFilter === 'ADJUSTMENT'" (click)="onFilterChange('ADJUSTMENT')">Adjustment</button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="loading-state" *ngIf="loading">
                <i class="fas fa-circle-notch fa-spin"></i>
                <p>Synchronizing Movement Log...</p>
            </div>

            <div *ngIf="!loading && filteredMovements.length === 0" class="empty-state">
                <i class="fas fa-history"></i>
                <h3>No Movements Found</h3>
                <p>Try adjusting your search or filters to find specific records.</p>
            </div>

            <div class="table-wrapper" *ngIf="!loading && filteredMovements.length > 0">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date / Time</th>
                            <th>Product Details</th>
                            <th>Warehouse</th>
                            <th class="type-col">Type</th>
                            <th class="numeric">Quantity</th>
                            <th>Reason / Ref</th>
                            <th>Recorded By</th>
                            <th class="actions-col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let m of filteredMovements" class="row-hover">
                            <td class="date-cell">
                                <span class="primary-text">{{ m.createdAt | date:'MMM d, y' }}</span>
                                <span class="secondary-text">{{ m.createdAt | date:'h:mm a' }}</span>
                            </td>
                            <td>
                                <div class="product-info">
                                    <span class="product-name">{{ m.product?.name }}</span>
                                    <span class="sku-badge">{{ m.product?.sku }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="warehouse-info">
                                    <i class="fas fa-warehouse muted"></i>
                                    <span>{{ m.warehouse?.name }}</span>
                                </div>
                            </td>
                            <td>
                                <span class="status-badge" [ngClass]="{
                                    'success': m.type === 'IN',
                                    'error': m.type === 'OUT',
                                    'warning': m.type === 'ADJUSTMENT'
                                }">
                                    <i class="fas" [ngClass]="{
                                        'fa-arrow-down': m.type === 'IN',
                                        'fa-arrow-up': m.type === 'OUT',
                                        'fa-sliders-h': m.type === 'ADJUSTMENT'
                                    }"></i>
                                    {{ m.type }}
                                </span>
                            </td>
                            <td class="numeric">
                                <span class="qty-value" [ngClass]="{
                                    'text-success': m.type === 'IN',
                                    'text-error': m.type === 'OUT'
                                }">
                                    {{ m.type === 'IN' ? '+' : (m.type === 'OUT' ? '-' : '') }}{{ m.quantity }}
                                </span>
                            </td>
                            <td>
                                <div class="reason-cell">
                                    <span class="reason-text">{{ m.reason || 'Manual Adjustment' }}</span>
                                    <span class="ref-text" *ngIf="m.reference">#{{ m.reference }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="user-info">
                                    <i class="fas fa-user-circle"></i>
                                    <span>{{ m.user?.name || 'System' }}</span>
                                </div>
                            </td>
                            <td class="actions-cell">
                                <div class="action-menu">
                                    <button class="btn-ghost" [routerLink]="['/stock/movements/edit', m._id]" title="Edit Movement">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-ghost btn-danger" (click)="onDelete(m._id)" title="Delete Movement">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

</div>

<app-confirm-modal
    [isVisible]="showDeleteModal"
    title="Delete Movement Record"
    [message]="getDeleteMessage()"
    confirmText="Delete & Reconcile"
    cancelText="Cancel"
    type="warning"
    (confirm)="confirmDelete()"
    (cancel)="cancelDelete()">
</app-confirm-modal>
