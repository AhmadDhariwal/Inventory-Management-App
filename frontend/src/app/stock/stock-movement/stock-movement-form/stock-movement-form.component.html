<div class="stock-form-container animate-fade-in">
    <header class="page-header">
        <div class="header-content">
            <div class="breadcrumb">
                <a routerLink="/stock/movements">Movements</a>
                <i class="fas fa-chevron-right"></i>
                <span>{{ isEditMode ? 'Edit' : 'New' }} Movement</span>
            </div>
            <h1>{{ isEditMode ? 'Edit' : 'Create' }} Stock Movement</h1>
            <p>Define stock adjustments, inbound receipts, or outbound shipments.</p>
        </div>
        <div class="header-actions">
            <button class="btn-secondary" routerLink="/stock/movements">Cancel</button>
            <button class="btn-primary" (click)="onSubmit()" [disabled]="loading">
                {{ loading ? 'Saving...' : (isEditMode ? 'Update' : 'Create') + ' Movement' }}
            </button>
        </div>
    </header>

    <main class="content-section">
        <div class="form-card">
            <form (ngSubmit)="onSubmit()" #movementForm="ngForm">
                <div class="form-grid">
                    <!-- Product Selection -->
                    <div class="form-group">
                        <label>Product <span class="required">*</span></label>
                        <select [(ngModel)]="movement.product" name="product" required #product="ngModel" [class.error]="product.invalid && product.touched">
                            <option value="">Select a product</option>
                            <option *ngFor="let p of products" [value]="p._id">{{ p.name }} ({{ p.sku }})</option>
                        </select>
                        <div class="error-msg" *ngIf="product.invalid && product.touched">Product is required</div>
                    </div>

                    <!-- Warehouse Selection -->
                    <div class="form-group">
                        <label>Warehouse <span class="required">*</span></label>
                        <select [(ngModel)]="movement.warehouse" name="warehouse" required #warehouse="ngModel" [class.error]="warehouse.invalid && warehouse.touched">
                            <option value="">Select a warehouse</option>
                            <option *ngFor="let w of warehouses" [value]="w._id">{{ w.name }}</option>
                        </select>
                        <div class="error-msg" *ngIf="warehouse.invalid && warehouse.touched">Warehouse is required</div>
                    </div>

                    <!-- Movement Type -->
                    <div class="form-group">
                        <label>Movement Type <span class="required">*</span></label>
                        <select [(ngModel)]="movement.type" name="type" required #type="ngModel" [class.error]="type.invalid && type.touched">
                            <option value="">Select type</option>
                            <option value="IN">Inbound (Stock In)</option>
                            <option value="OUT">Outbound (Stock Out)</option>
                            <option value="ADJUSTMENT">Adjustment</option>
                        </select>
                        <div class="error-msg" *ngIf="type.invalid && type.touched">Type is required</div>
                    </div>

                    <!-- Quantity -->
                    <div class="form-group">
                        <label>Quantity <span class="required">*</span></label>
                        <input type="number" [(ngModel)]="movement.quantity" name="quantity" required min="1" #qty="ngModel" [class.error]="qty.invalid && qty.touched">
                        <div class="error-msg" *ngIf="qty.invalid && qty.touched">Quantity must be at least 1</div>
                    </div>

                    <!-- Reference -->
                    <div class="form-group">
                        <label>Reference #</label>
                        <input type="text" [(ngModel)]="movement.reference" name="reference" placeholder="e.g. PO-12345">
                    </div>

                    <!-- Reason -->
                    <div class="form-group full-width">
                        <label>Reason <span class="required">*</span></label>
                        <textarea [(ngModel)]="movement.reason" name="reason" required rows="3" placeholder="Explain why this movement is being made..." #reason="ngModel" [class.error]="reason.invalid && reason.touched"></textarea>
                        <div class="error-msg" *ngIf="reason.invalid && reason.touched">Reason is required</div>
                    </div>
                </div>
            </form>
        </div>

        <div class="info-banner" *ngIf="!isEditMode">
            <i class="fas fa-info-circle"></i>
            <div class="banner-content">
                <strong>Important Note:</strong>
                <p>Creating a movement will immediately affect the available stock in the selected warehouse. Please double-check quantities before saving.</p>
            </div>
        </div>
    </main>
</div>
