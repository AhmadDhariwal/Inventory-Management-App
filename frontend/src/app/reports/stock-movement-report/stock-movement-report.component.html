<section class="stock-movement-report">

  <!-- PAGE HEADER -->
  <header class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1>Stock Movement Report</h1>
        <p>Complete audit trail of inventory transactions</p>
      </div>
      <div class="export-actions no-print">
        <button type="button" class="btn btn-outline" (click)="exportCSV()" aria-label="Export to CSV">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14,2 14,8 20,8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10,9 9,9 8,9"></polyline>
          </svg>
          CSV
        </button>
        <button type="button" class="btn btn-outline" (click)="exportExcel()" aria-label="Export to Excel">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14,2 14,8 20,8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10,9 9,9 8,9"></polyline>
          </svg>
          Excel
        </button>
        <button type="button" class="btn btn-primary" (click)="printReport()" aria-label="Print report">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6,9 6,2 18,2 18,9"></polyline>
            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
            <polyline points="6,14 6,22 18,22 18,14"></polyline>
          </svg>
          Print
        </button>
      </div>
    </div>
  </header>

  <!-- FILTER BAR -->
  <div class="filter-bar no-print">
    <div class="filter-group">
      <label for="type-filter">Movement Type</label>
      <select id="type-filter" [(ngModel)]="selectedType" (change)="applyFilters()" aria-label="Filter by type">
        <option *ngFor="let t of types" [value]="t">{{ t === 'ALL' ? 'All Types' : t }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="warehouse-filter">Warehouse</label>
      <select id="warehouse-filter" [(ngModel)]="selectedWarehouse" (change)="applyFilters()" aria-label="Filter by warehouse">
        <option *ngFor="let w of warehouses" [value]="w">{{ w === 'ALL' ? 'All Warehouses' : w }}</option>
      </select>
    </div>
  </div>

  <!-- MOVEMENT TABLE -->
  <div *ngIf="isLoading" class="loading-state">
    <p>Loading stock movements...</p>
  </div>

  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadStockMovements()" class="btn btn-primary">Retry</button>
  </div>

  <div *ngIf="!isLoading && !error" class="table-container">

    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th scope="col">Date</th>
            <th scope="col">SKU</th>
            <th scope="col">Product</th>
            <th scope="col">Warehouse</th>
            <th scope="col">Type</th>
            <th scope="col">Quantity</th>
            <th scope="col">Reason</th>
            <th scope="col">Performed By</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let m of filteredMovements; trackBy: trackByMovement">
            <td data-label="Date">{{ m.createdAt | date:'MMM d, y' }}</td>
            <td data-label="SKU">{{ getSku(m) }}</td>
            <td data-label="Product">{{ getProductName(m) }}</td>
            <td data-label="Warehouse">{{ getWarehouseName(m) }}</td>
            <td data-label="Type">
              <span class="movement-type" [ngClass]="getMovementClass(m.type)">{{ m.type }}</span>
            </td>
            <td data-label="Quantity" class="numeric">{{ m.quantity }}</td>
            <td data-label="Reason">{{ m.reason || 'N/A' }}</td>
            <td data-label="Performed By">{{ getUserName(m) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</section>
