<main class="purchase-list-container">
  <header class="page-header animate-fade-in">
    <div class="header-content">
      <div class="title-section">
        <h1>Purchase Orders</h1>
        <p class="subtitle">Procurement cycle management and inbound logistics tracking.</p>
      </div>
      
      <div class="action-buttons">
        <a routerLink="/purchases/new" class="btn-primary">
          <i class="fas fa-file-invoice-doll"></i>
          Initiate Order
        </a>
        <button class="btn-outline" (click)="refreshList()">
          <i class="fas fa-sync-alt"></i>
          Sync Orders
        </button>
        
        <div class="export-dropdown">
          <button class="btn-outline" (click)="toggleExportDropdown()">
            <i class="fas fa-download"></i>
            Export
          </button>
          <div class="dropdown-menu" [class.show]="showExportDropdown">
            <button class="dropdown-item" (click)="exportCSV()">
              <i class="fas fa-file-csv"></i> CSV Dataset
            </button>
            <button class="dropdown-item" (click)="exportExcel()">
              <i class="fas fa-file-excel"></i> Excel Sheet
            </button>
            <button class="dropdown-item" (click)="printList()">
              <i class="fas fa-print"></i> Physical Copy
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="content-section animate-fade-in">
    <div class="toolbar">
      <div class="search-field">
        <i class="fas fa-search search-icon"></i>
        <input 
          type="text" 
          class="search-control" 
          placeholder="Search by supplier, warehouse, or initiator..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()">
      </div>

      <div class="filter-controls">
        <select class="filter-select" [(ngModel)]="selectedSupplier" (change)="onFilter()">
          <option value="">All Strategic Partners</option>
          <option *ngFor="let supplier of suppliers" [value]="supplier._id">{{ supplier.name }}</option>
        </select>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-state">
      <i class="fas fa-circle-notch fa-spin"></i>
      <p>Consulting Ledger...</p>
    </div>

    <!-- Empty -->
    <div *ngIf="!isLoading && filteredPurchaseOrders.length === 0" class="empty-state">
      <i class="fas fa-clipboard-list"></i>
      <h3>No procurement records found</h3>
      <p>Adjust your parameters or initiate a new request.</p>
    </div>

    <!-- Premium Table -->
    <div *ngIf="!isLoading && filteredPurchaseOrders.length > 0" class="table-container">
      <div class="table-wrapper">
        <table class="data-table">
          <thead>
            <tr>
              <th class="sortable" (click)="sortBy('orderNumber')">PO ID</th>
              <th class="sortable" (click)="sortBy('supplier')">Strategic Partner</th>
              <th class="sortable" (click)="sortBy('warehouse')">Target Facility</th>
              <th class="numeric sortable" (click)="sortBy('totalamount')">Transaction Value</th>
              <th class="sortable" (click)="sortBy('createdAt')">Inception Date</th>
              <th>Status</th>
              <th class="actions-col"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let po of filteredPurchaseOrders; let i=index">
              <td><span class="order-badge">PO-{{ generateOrderNumber(i) }}</span></td>
              <td><span style="font-weight: 700">{{ getSupplierName(po) }}</span></td>
              <td>{{ getWarehouseName(po) }}</td>
              <td class="numeric">{{ po.totalamount | currency }}</td>
              <td class="date-time">{{ po.createdAt | date:'MMM d, y' }}</td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(po.status || 'PENDING')">
                  {{ po.status || 'PENDING' }}
                </span>
              </td>
              <td class="actions-cell">
                <div class="action-menu">
                  <button class="btn-ghost" (click)="viewPurchaseOrder(po)" title="Review Details">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button *ngIf="po.status === 'PENDING'" class="btn-ghost" (click)="approvePurchaseOrder(po)" title="Approve Request" style="color: var(--status-success)">
                    <i class="fas fa-check-circle"></i>
                  </button>
                  <button *ngIf="po.status === 'APPROVED'" class="btn-ghost" (click)="receivePurchaseOrder(po)" title="Confirm Inbound" style="color: var(--brand-primary)">
                    <i class="fas fa-box"></i>
                  </button>
                  <button *ngIf="po.status === 'PENDING'" class="btn-ghost btn-danger" (click)="deletePurchaseOrder(po)" title="Void Request">
                    <i class="fas fa-times-circle"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination Control -->
      <nav class="pagination-nav">
        <div class="pagination-info">
          Displaying <strong>{{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalItems) }}</strong> of <strong>{{ totalItems }}</strong> records
        </div>
        <div class="pagination-controls">
          <button class="btn-ghost" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <div class="page-numbers">
            <button *ngFor="let page of getPageNumbers()" class="page-btn" [class.active]="page === currentPage" (click)="goToPage(page)">
              {{ page }}
            </button>
          </div>
          <button class="btn-ghost" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </nav>
    </div>
  </div>

  <app-confirm-modal
    [isVisible]="showDeleteModal"
    title="Void Purchase Order"
    [message]="'Confirm permanent voiding of order from ' + deletePurchaseOrderName + '?'"
    confirmText="Void Order"
    type="warning"
    (confirm)="confirmDelete()"
    (cancel)="cancelDelete()">
  </app-confirm-modal>
</main>
